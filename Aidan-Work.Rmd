---
title: "Dairy Data"
author: "Aidan Bobholz"
date: "2024-04-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Title

## Dairy Data

# Team Members

## Aidan Bobholz and Gavin Anderson

# Data

```{R, include = FALSE}

# Load the readxl package
library(tidyverse)
library(readxl)


library(readr)

# Read the CSV file from GitHub

dataset <- read.csv("pcconsp_1_csv.csv")

```

```{R}

str(dataset)

```

```{R}

summary(dataset)

```

```{R}

head(dataset)


```


# Questions:

## What is the current trend of dairy products?

```{R}

# Load necessary libraries
library(ggplot2)
library(reshape2)
library(viridis)


my_palette <- viridis(22)

dataset <- dataset %>% select(-one_of('Skim_solids_basis ', 'Frozen_Yougurt ', 'Milk_fat_basis '))



head(dataset)

# Reshape data into long format
melted_data <- melt(dataset, id.vars = "Year")

head(melted_data)

# Create density plot
sales <- ggplot(melted_data, aes(x = variable, y = value)) +
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggsave("sales_counts.jpeg", sales)

melted_data_below100 <- melted_data %>% 
  filter(value <= 100)

ggplot(melted_data_below100, aes(x = variable, y = value)) +
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggplot(melted_data_below100, aes(x = Year, y = value , color = variable)) +
  geom_line()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  scale_color_manual(values = my_palette)


```

*This visual will be in works of improvements but as a start helps show the major variables in this dataset. Also we can find that the value of fluid beverage milk has been on a constant decline. By working on this visual further we may see even more trends with dairy products.*

## What is the most popularly consumed dairy product?

```{R}

head(dataset)

```

```{R}

my_palette <- viridis(22)

# Reshape data into long format
melted_data <- melt(dataset, id.vars = "Year")


# Create density plot
sales <- ggplot(melted_data, aes(x = variable, y = value)) +
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggsave("sales_counts.jpeg", sales)

melted_data_below100 <- melted_data %>% 
  filter(value <= 100)

ggplot(melted_data_below100, aes(x = variable, y = value)) +
  geom_boxplot()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))

ggplot(melted_data_below100, aes(x = Year, y = value , color = variable)) +
  geom_line()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  scale_color_manual(values = my_palette)

```

```{R}

head(melted_data, 3)

```

```{R}

#Creating catgories based on the variable identifier

categorize <- function(variable_name) {
  if (grepl("American_Cheese", variable_name, ignore.case = TRUE)) {
    return("Cheese")
  } else if (grepl("Other_than_American_Cheese", variable_name, ignore.case = TRUE)) {
    return("Cheese")
  } else if (grepl("Cottage_Cheese", variable_name, ignore.case = TRUE)) {
    return("Cheese")
  } else if (grepl("Dry_Whole_Milk", variable_name, ignore.case = TRUE)) {
    return("Dry_products")
  } else if (grepl("Nonfat_and_Skim_milk_powder", variable_name, ignore.case = TRUE)) {
    return("Dry_products")
  } else if (grepl("Dry_Butter_Milk", variable_name, ignore.case = TRUE)) {
    return("Dry_products")
  } else if (grepl("Dry_Whey_and_Whey_Protein_Concentrate", variable_name, ignore.case = TRUE)) {
    return("Dry_products")
  } else if (grepl("Regular_Ice_Cream", variable_name, ignore.case = TRUE)) {
    return("Frozen_products")
  } else if (grepl("Low_Fat_Ice_Cream", variable_name, ignore.case = TRUE)) {
    return("Frozen_products")
  } else if (grepl("Sherbet", variable_name, ignore.case = TRUE)) {
    return("Frozen_products")
  } else if (grepl("Other_Frozen_Dairy", variable_name, ignore.case = TRUE)) {
    return("Frozen_products")
  } else if (grepl("Water_And_Juices", variable_name, ignore.case = TRUE)) {
    return("Frozen_products")
  } else if (grepl("Whole_Condensed_Milk_Canned", variable_name, ignore.case = TRUE)) {
    return("Evaporated_Condensed_Milk")
  } else if (grepl("Whole_Condensed_Milk_Bulk", variable_name, ignore.case = TRUE)) {
    return("Evaporated_Condensed_Milk")
  } else if (grepl("Skim_Condensed_Milk_Bulk_Canned", variable_name, ignore.case = TRUE)) {
    return("Evaporated_Condensed_Milk")
  } else {
    return("Other")
  }
}

melted_data$Category <- sapply(melted_data$variable, categorize)

head(melted_data)


```



```{R}



ggplot(melted_data, aes(x = Year, y = log(value), color = variable)) +
  geom_line() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  facet_wrap(~ Category, scales = "free_y")

# Filter out the "Other" category
filtered_data <- melted_data %>%
  filter(Category != "Other")

# Create the plot
ggplot(filtered_data, aes(x = Year, y = log(value), color = variable)) +
  geom_line() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  facet_wrap(~ Category, scales = "free_y")
ggsave("trends_facet.jpeg")
  


```

**More questions are to come as we continue to go through this dataset**

```{R}

dataset_effect <- read.csv("annualmilkprodfactors.csv")

head(dataset_effect)


```

```{R}

# Assuming your data frame is named "df"
dataset_effect <- subset(dataset_effect, select = c(Year, Alfalfa.hay.price.received.by.farmers4, Average.price.paid.for.milk1, Milk_Cow_Price))

dataset_effect$Milk_Cow_Price <- as.numeric(gsub(",", "", dataset_effect$Milk_Cow_Price))

head(dataset_effect)


```

```{R}

melted_data_effect <- melt(dataset_effect, id.vars = "Year")

head(melted_data_effect)


```


```{r}

melted_data_cheese <- melted_data %>% 
  filter(melted_data$Category == "Cheese")

melted_data_dry_products <- melted_data %>% 
  filter(melted_data$Category == "Dry_products")

melted_data_Evaporated_Condensed_Milk <- melted_data %>% 
  filter(melted_data$Category == "Evaporated_Condensed_Milk")

melted_data_Frozen_products <- melted_data %>% 
  filter(melted_data$Category == "Frozen_products")


```

```{R}

#Removal of Category
melted_data_cheese <- melted_data_cheese %>% select(-one_of('Category'))
melted_data_dry_products <- melted_data_dry_products %>% select(-one_of('Category'))
melted_data_Evaporated_Condensed_Milk <- melted_data_Evaporated_Condensed_Milk %>% select(-one_of('Category'))
melted_data_Frozen_products <- melted_data_Frozen_products %>% select(-one_of('Category'))

#Variable specific dataframe of effect

alfalfa_price <- melted_data_effect %>% 
  filter(melted_data_effect$variable == "Alfalfa.hay.price.received.by.farmers4")
milk_price <- melted_data_effect %>% 
  filter(melted_data_effect$variable == "Average.price.paid.for.milk1")
milk_cow <- melted_data_effect %>% 
  filter(melted_data_effect$variable == "Milk_Cow_Price")

#Creation of sub dataframes for visualization of relations

alfalfa_cheese <- bind_rows(alfalfa_price, melted_data_cheese)
alfalfa_dry <- bind_rows(alfalfa_price, melted_data_dry_products)
alfalfa_evaporated <- bind_rows(alfalfa_price, melted_data_Evaporated_Condensed_Milk)
alfalfa_frozen <- bind_rows(alfalfa_price, melted_data_Frozen_products)

milk_price_cheese <- bind_rows(milk_price, melted_data_cheese)
milk_price_dry <- bind_rows(milk_price, melted_data_dry_products)
milk_price_evaporated <- bind_rows(milk_price, melted_data_Evaporated_Condensed_Milk)
milk_price_frozen <- bind_rows(milk_price, melted_data_Frozen_products)

milk_cow_cheese <- bind_rows(milk_cow, melted_data_cheese)
milk_cow_dry <- bind_rows(milk_cow, melted_data_dry_products)
milk_cow_evaporated <- bind_rows(milk_cow, melted_data_Evaporated_Condensed_Milk)
milk_cow_frozen <- bind_rows(milk_cow, melted_data_Frozen_products)


```

```{R}
#Graphs of alfalfa and commodity

ggplot(alfalfa_cheese, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Alfalfa price and Cheese consumption")
ggsave("alfalfa_cheese.jpeg")

ggplot(alfalfa_dry, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Alfalfa price and Dry products consumption")
ggsave("alfalfa_dry.jpeg")

ggplot(alfalfa_evaporated, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Alfalfa price and Evaporated and Condensed milk consumption")
ggsave("alfalfa_evaporated.jpeg")

ggplot(alfalfa_frozen, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Alfalfa price and Frozen products consumption")
ggsave("alfalfa_frozen.jpeg")


```
```{R}
#Graphs of alfalfa and commodity

ggplot(milk_price_cheese, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk price and Cheese consumption")
ggsave("milk_price_cheese.jpeg")

ggplot(milk_price_dry, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk price and Dry products consumption")
ggsave("milk_price_dry.jpeg")

ggplot(milk_price_evaporated, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk price and Evaporated and Condensed milk consumption")
ggsave("milk_price_evaporated.jpeg")

ggplot(milk_price_frozen, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk price and Frozen products consumption")
ggsave("milk_price_frozen.jpeg")


```

```{R}
#Graphs of alfalfa and commodity

ggplot(milk_cow_cheese, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk cow price and Cheese consumption")
ggsave("milk_cow_cheese.jpeg")

ggplot(milk_cow_dry, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk cow price and Dry products consumption")
ggsave("milk_cow_dry.jpeg")

ggplot(milk_cow_evaporated, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk cow price and Evaporated and Condensed milk consumption")
ggsave("milk_cow_evaporated.jpeg")

ggplot(milk_cow_frozen, aes(x = Year, y = log(value) , color = variable)) +
  geom_step()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
  labs(title = "Relation of Milk cow price and Frozen products consumption")
ggsave("milk_cow_frozen.jpeg")


```
